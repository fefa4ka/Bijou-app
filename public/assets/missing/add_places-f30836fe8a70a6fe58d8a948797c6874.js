$(function(){function a(a){$.getJSON("/add_missing/address_data.json",{address:a},function(a,b,c){if(a.address){var d={lat:a.lat,lng:a.lng,title:a.address};$(".b-form__place").hide(),$(".b-form__add_place").show(),$(".b-form__add_place_address").val(a.address),$(window).scrollTop($(".b-form__add_place").offset().top),$(".b-form__add_place_name").focus()}})}function b(a){return $(".b-form__add_place").hide(),$(".b-form__place").show(),$(".b-form__add_place .b-form__field input, .b-form__add_place .b-form__field textarea").val(""),a.clear_search_field&&$(".b-form__place_search_text_field").val(""),$(".b-form__place_search_text_field").focus(),!1}$(".b-form__place_search_text_field").length!=0&&($(".b-form__place_search_text_field").autocomplete({minLength:2,source:function(a,b){var c=Gmaps.map.map.getBounds(),d=Gmaps.map.map.getCenter(),e=c.getNorthEast(),f=c.getSouthWest(),g={lng:e.lng()-f.lng(),lat:e.lat()-f.lat()};ll=[d.lng(),d.lat()].join(","),spn=[g.lng,g.lat].join(","),$.ajax({url:"/add_missing/address_suggest.json",dataType:"jsonp",data:{part:a.term,ll:ll,spn:spn},success:function(a){b($.map(a[1],function(a){var b=a[1],c=a[2];label="";for(i in b){var a=b[i];typeof a=="object"&&a instanceof Array?label+="<b>"+a[1]+"</b>":label+=a}return{label:label,value:c}}))}})},select:function(b,c){a(c.item.value)}}).keydown(function(a){if(a.keyCode==13)return $(".b-form__place_search_button").click(),!1}).data("autocomplete")._renderItem=function(a,b){return $("<li></li>").data("item.autocomplete",b).append("<a>"+b.label+"</a>").appendTo(a)}),$(".b-form__place_search_button").click(function(){a($(".b-form__place_search_text_field").val())}),$(".b-form__add_place_button_cancel").live("click",b),log("loading add_places"),$(".b-form__add_place_button").live("click",function(){log(this);var a=".b-form__add_place_",c=["name","address","description","missing"],d=(new Date).getTime(),e=$("<div></div>").addClass("b-form__field b-form__place").append($("<div></div>").addClass("b-form__label").text($(a+c[0]).val())).append($("<p></p>").text($(a+c[2]).nl2br().val())).append($("<p class='t-small'></p>").text($(a+c[1]).val()));add_hidden_fields(e,a,c),console.log(e),$(".b-form__places").append(e),b({clear_search_field:!0}),redirect_disallow=!0,$("#new_missing").submit()}),$(".b-form__add_place_missing").live("change",function(){var a=$(".b-form__its_missing_place_date"),b=$(".b-form__add_place_missing:checked").val()!==undefined?a.show():a.hide()}),$(".b-form__place .destroy").live("click",function(){$(this).toggle(function(){$(this).val("восстановить").removeClass("red_action").addClass("silver_action").parents(".b-form__place").removeClass("active").addClass("deleted").find('input[name$="[_destroy]"]').val(1)},function(){$(this).val("удалить").removeClass("silver_action").addClass("red_action").parents(".b-form__place").removeClass("deleted").addClass("active").find('input[name$="[_destroy]"]').val(0)}).trigger("click")})})